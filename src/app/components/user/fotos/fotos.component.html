<div class="fotos-container">
  <div class="page-header">
    <h1>📸 Fotos dos Animais</h1>
    <p>Confira as fotos exclusivas dos nossos amiguinhos</p>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <h3>Filtrar Fotos</h3>
    <form [formGroup]="filterForm" class="filters-form">
      <div class="form-group">
        <label for="animal">Nome do Animal</label>
        <select id="animal" formControlName="animal" class="animal-select">
          <option value="">Todos os animais</option>
          @for (animal of animaisDisponiveis; track animal._id) {
          <option [value]="animal.nome">
            {{ animal.tipo === 'cachorro' ? '🐕' : animal.tipo === 'gato' ? '🐱' : '🐾' }}
            {{ animal.nome }}
          </option>
          }
        </select>

        <!-- Thumbnails dos animais -->
        @if (animaisDisponiveis.length > 0) {
        <div class="animal-thumbnails">
          @for (animal of animaisDisponiveis; track animal._id) {
          <div class="animal-thumb" [class.selected]="filterForm.get('animal')?.value === animal.nome"
            (click)="filterForm.patchValue({ animal: animal.nome })" [title]="animal.nome">
            @if (animal.fotoUrl || animal.fotoPerfil?.url) {
            <img [src]="getFullImageUrl(animal.fotoUrl || animal.fotoPerfil?.url)" [alt]="animal.nome">
            } @else {
            <div class="animal-placeholder">
              {{ animal.tipo === 'cachorro' ? '🐕' : animal.tipo === 'gato' ? '🐱' : '🐾' }}
            </div>
            }
            <span class="animal-name">{{ animal.nome }}</span>
          </div>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="especie">Espécie</label>
        <select id="especie" formControlName="especie">
          <option value="">Todas</option>
          <option value="cachorro">🐕 Cachorro</option>
          <option value="gato">🐱 Gato</option>
          <option value="outro">🐾 Outro</option>
        </select>
      </div>

      <div class="form-group">
        <label for="mes">Mês</label>
        <select id="mes" formControlName="mes">
          <option value="">Todos</option>
          @for (mes of mesesDisponiveis; track mes) {
          <option [value]="mes">
            {{ formatMes(mes) }}
          </option>
          }
        </select>
      </div>

      <button type="button" (click)="clearFilters()" class="btn-clear">
        Limpar Filtros
      </button>
    </form>
  </div>

  <!-- Loading -->
  @if (isLoading) {
  <div class="loading">
    <div class="spinner"></div>
    <p>Carregando fotos...</p>
  </div>
  }

  <!-- Grid de Fotos -->
  @if (!isLoading && filteredPhotos.length > 0) {
  <div class="photos-grid">
    @for (photo of filteredPhotos; track photo._id) {
    <div class="photo-card" (click)="openPhoto(photo)">
      <div class="photo-image">
        <img [src]="photo.imagemUrl" [alt]="photo.animalNome" [title]="photo.animalNome" role="img">
        <div class="photo-overlay">
          <span class="view-icon">👁️</span>
        </div>
      </div>
      <div class="photo-info">
        <h4>{{ photo.animalNome }}</h4>
        <p class="photo-date">{{ formatMes(photo.mes) }}</p>
      </div>
    </div>
    }
  </div>
  }

  <!-- Nenhuma foto -->
  @if (!isLoading && filteredPhotos.length === 0) {
  <div class="no-photos">
    <span class="icon">📷</span>
    <h3>Nenhuma foto encontrada</h3>
    <p>Tente ajustar os filtros</p>
    <button (click)="clearFilters()" class="btn-primary">Limpar Filtros</button>
  </div>
  }
</div>

<!-- Modal de Foto -->
@if (selectedPhoto) {
<div class="photo-modal" (click)="closePhoto()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closePhoto()">✕</button>

    <div class="modal-image">
      <img [src]="selectedPhoto.imagemUrl" [alt]="selectedPhoto.animalNome" [title]="selectedPhoto.animalNome"
        role="img">
    </div>

    <div class="modal-info">
      <h2>{{ selectedPhoto.animalNome }}</h2>
      <p class="description">{{ selectedPhoto.descricao }}</p>
      <div class="modal-meta">
        <span class="meta-item">
          <span class="icon">{{ selectedPhoto.animalEspecie === 'cachorro' ? '🐕' : '🐱' }}</span>
          {{ selectedPhoto.animalEspecie === 'cachorro' ? 'Cachorro' : 'Gato' }}
        </span>
        <span class="meta-item">
          <span class="icon">📅</span>
          {{ formatMes(selectedPhoto.mes) }}
        </span>
      </div>
    </div>
  </div>
</div>
}