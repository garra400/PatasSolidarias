<div class="user-layout">
  <!-- Sidebar Toggle Button -->
  <button class="sidebar-toggle" (click)="toggleSidebar()" [class.open]="isSidebarOpen" title="Menu">
    <span class="hamburger-icon">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </span>
  </button>

  <!-- Sidebar -->
  <aside class="sidebar" [class.open]="isSidebarOpen" [class.collapsed]="!isSidebarOpen"
    [class.no-transition]="isFirstRender">
    <div class="sidebar-header">
      <div class="user-avatar-wrapper" (click)="abrirModalFoto()" title="Clique para trocar a foto">
        @if (currentUser?.fotoPerfil) {
        <img [src]="getFullImageUrl(currentUser.fotoPerfil)" alt="Foto de perfil" class="user-avatar">
        } @else {
        <img src="/images/default-avatar.svg" alt="Foto de perfil" class="user-avatar">
        }
        <div class="camera-overlay">
          <span class="camera-icon">📷</span>
        </div>
      </div>
      <h3>{{ currentUser?.nome || 'Minha Conta' }}</h3>
    </div>

    <nav class="sidebar-nav">
      <!-- Mostrar "Seja Apoiador" apenas se NÃO for assinante -->
      <a *ngIf="!hasAssinatura()" routerLink="/conta/seja-apoiador" routerLinkActive="active" class="nav-item">
        <span class="icon">💝</span>
        <span>Seja Apoiador</span>
      </a>

      <!-- Mostrar "Doar Novamente" se já for doador (PIX ou Assinatura) -->
      <a *ngIf="isDoador()" routerLink="/conta/doar-novamente" routerLinkActive="active" class="nav-item">
        <span class="icon">💰</span>
        <span>Doar Novamente</span>
      </a>

      <!-- Opções exclusivas para doadores -->
      <a *ngIf="isDoador()" routerLink="/conta/meus-brindes" routerLinkActive="active" class="nav-item">
        <span class="icon">🎁</span>
        <span>Meus Brindes</span>
      </a>

      <a *ngIf="isDoador()" routerLink="/conta/fotos" routerLinkActive="active" class="nav-item">
        <span class="icon">📸</span>
        <span>Fotos dos Animais</span>
      </a>

      <a *ngIf="isDoador()" routerLink="/conta/pagamentos" routerLinkActive="active" class="nav-item">
        <span class="icon">💳</span>
        <span>Histórico de Pagamentos</span>
      </a>

      <!-- Mostrar "Minha Assinatura" apenas se tiver assinatura ativa -->
      <a *ngIf="hasAssinatura()" routerLink="/conta/assinatura" routerLinkActive="active" class="nav-item">
        <span class="icon">📋</span>
        <span>Minha Assinatura</span>
      </a>

      <a routerLink="/conta/configuracoes" routerLinkActive="active" class="nav-item">
        <span class="icon">⚙️</span>
        <span>Configurações</span>
      </a>

      <!-- Botão Admin - apenas para admins -->
      <a *ngIf="isAdmin()" routerLink="/adm/dashboard" class="nav-item admin-link">
        <span class="icon">🛡️</span>
        <span>Painel Administrativo</span>
      </a>

      <div class="nav-divider"></div>

      <a routerLink="/" class="nav-item">
        <span class="icon">🏠</span>
        <span>Voltar para Home</span>
      </a>

      <button (click)="logout()" class="nav-item logout-btn">
        <span class="icon">🚪</span>
        <span>Sair</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content" [class.no-transition]="isFirstRender">
    <router-outlet></router-outlet>
  </main>
</div>

<!-- Sidebar Overlay (Mobile) -->
@if (isSidebarOpen) {
<div class="sidebar-overlay" (click)="toggleSidebar()"></div>
}

<!-- Modal de Trocar Foto de Perfil -->
<app-trocar-foto-perfil-modal [mostrar]="mostrarModalFoto" (fechar)="fecharModalFoto()"
  (fotoAtualizada)="onFotoAtualizada($event)"></app-trocar-foto-perfil-modal>