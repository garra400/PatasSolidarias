<div class="meus-brindes-container">
  <!-- Hero Header -->
  <div class="hero-header">
    <div class="hero-content">
      <div class="icon-badge">
        <i class="fas fa-gift"></i>
      </div>
      <h1>Meus Brindes</h1>
      <p>Recompensas especiais por apoiar os nossos pets</p>
    </div>
  </div>

  <!-- Progress Card -->
  <div class="progress-card">
    <div class="progress-header">
      <h2>Seu Progresso</h2>
      <div class="stats-inline">
        <div class="stat-badge">
          <i class="fas fa-calendar-check"></i>
          <span>{{ totalMesesApoio }} {{ totalMesesApoio === 1 ? 'mÃªs' : 'meses' }}</span>
        </div>
        <div class="stat-badge premium">
          <i class="fas fa-crown"></i>
          <span>{{ brindesDisponiveis }} {{ brindesDisponiveis === 1 ? 'brinde' : 'brindes' }}</span>
        </div>
      </div>
    </div>

    <!-- Barra de progresso visual -->
    <div class="progress-visual">
      <div class="progress-bar-container">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" [style.width.%]="((totalMesesApoio % 3) / 3) * 100"></div>
        </div>
        <div class="progress-milestones">
          <div class="milestone" [class.completed]="totalMesesApoio >= 1">
            <div class="milestone-dot"></div>
            <span>1Âº mÃªs</span>
          </div>
          <div class="milestone" [class.completed]="totalMesesApoio >= 2">
            <div class="milestone-dot"></div>
            <span>2Âº mÃªs</span>
          </div>
          <div class="milestone completed">
            <div class="milestone-dot">
              <i class="fas fa-gift"></i>
            </div>
            <span>3Âº mÃªs</span>
          </div>
        </div>
      </div>

      <div class="progress-info">
        <i class="fas fa-info-circle"></i>
        <p>
          @if (totalMesesApoio % 3 === 0 && brindesDisponiveis > 0) {
          <span>ParabÃ©ns! VocÃª ganhou um novo brinde! ðŸŽ‰</span>
          }
          @if (totalMesesApoio % 3 !== 0) {
          <span>
            Faltam <strong>{{ 3 - (totalMesesApoio % 3) }}</strong>
            {{ (3 - (totalMesesApoio % 3)) === 1 ? 'mÃªs' : 'meses' }} para o prÃ³ximo brinde
          </span>
          }
        </p>
      </div>
    </div>
  </div>

  <!-- Brindes DisponÃ­veis -->
  @if (brindesDisponiveis > 0) {
  <div class="section">
    <div class="section-header">
      <h2>
        <i class="fas fa-star"></i>
        Seus Brindes DisponÃ­veis
      </h2>
      <span class="badge-count">{{ brindesDisponiveis }}</span>
    </div>

    @if (isLoadingBrindes) {
    <div class="loading-brindes">
      <div class="spinner"></div>
      <p>Carregando brindes...</p>
    </div>
    }

    @if (!isLoadingBrindes && brindesCatalogo.length > 0) {
    <div class="brindes-grid">
      @for (brinde of brindesCatalogo; track brinde.id) {
      <div class="brinde-card premium">
        <div class="brinde-ribbon">
          <i class="fas fa-gift"></i>
          DisponÃ­vel
        </div>
        <div class="brinde-image">
          <img [src]="brinde.foto" [alt]="brinde.nome" [title]="brinde.nome" role="img">
          <div class="brinde-overlay">
            <i class="fas fa-gift fa-3x"></i>
          </div>
        </div>
        <div class="brinde-content">
          <h3>{{ brinde.nome }}</h3>
          <p>{{ brinde.descricao }}</p>

          <div class="brinde-actions">
            <button class="btn-primary" (click)="abrirModalResgate(brinde)">
              <i class="fas fa-hand-holding-heart"></i>
              Resgatar Brinde
            </button>
          </div>
        </div>
      </div>
      }
    </div>
    }

    @if (!isLoadingBrindes && brindesCatalogo.length === 0) {
    <div class="empty-brindes">
      <i class="fas fa-inbox"></i>
      <p>Nenhum brinde disponÃ­vel no momento. Em breve novos brindes serÃ£o adicionados!</p>
    </div>
    }
  </div>
  }

  <!-- Brinde do MÃªs Atual -->
  <div class="section">
    <div class="section-header">
      <h2>
        <i class="fas fa-calendar-star"></i>
        Brinde Especial do MÃªs
      </h2>
      <span class="badge-new">Novidade</span>
    </div>

    <div class="featured-brinde">
      @for (brinde of brindesDoMes; track brinde.id) {
      <div class="featured-content">
        <div class="featured-image">
          <img [src]="brinde.imagemUrl" [alt]="brinde.nome" [title]="brinde.nome" role="img">
          <div class="featured-badge">
            <i class="fas fa-sparkles"></i>
            Exclusivo
          </div>
        </div>
        <div class="featured-info">
          <h3>{{ brinde.nome }}</h3>
          <p class="description">{{ brinde.descricao }}</p>

          <div class="features-list">
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Exclusivo para apoiadores</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>EdiÃ§Ã£o limitada do mÃªs</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Enviado para sua casa</span>
            </div>
          </div>

          <div class="cta-info">
            <p>Apoie por 3 meses e ganhe este brinde especial!</p>
            <button class="btn-cta" routerLink="/conta/doar-novamente">
              <i class="fas fa-heart"></i>
              Apoiar Agora
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>

  <!-- Empty State -->
  @if (brindesDisponiveis === 0) {
  <div class="section">
    <div class="empty-state-premium">
      <div class="empty-icon">
        <i class="fas fa-box-heart"></i>
      </div>
      <h3>Continue Apoiando!</h3>
      <p class="empty-description">
        VocÃª estÃ¡ fazendo a diferenÃ§a! Continue seu apoio e ganhe brindes exclusivos.
      </p>

      <div class="empty-progress">
        <div class="circle-progress">
          <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" class="circle-bg"></circle>
            <circle cx="50" cy="50" r="45" class="circle-progress-bar"
              [style.stroke-dashoffset]="283 - (283 * (totalMesesApoio % 3) / 3)"></circle>
          </svg>
          <div class="circle-text">
            <span class="months">{{ totalMesesApoio % 3 }}</span>
            <span class="total">/3</span>
          </div>
        </div>
        <p class="progress-label">Meses de apoio</p>
      </div>

      <button class="btn-secondary" routerLink="/conta/doar-novamente">
        <i class="fas fa-arrow-right"></i>
        Continuar Apoiando
      </button>
    </div>
  </div>
  }

  <!-- Como Funciona -->
  <div class="how-it-works">
    <h3>
      <i class="fas fa-lightbulb"></i>
      Como Funcionam os Brindes?
    </h3>

    <div class="steps-grid">
      <div class="step-card">
        <div class="step-number">1</div>
        <div class="step-icon">
          <i class="fas fa-heart-circle-check"></i>
        </div>
        <h4>Apoie o Projeto</h4>
        <p>FaÃ§a doaÃ§Ãµes mensais via PIX ou assinatura</p>
      </div>

      <div class="step-card">
        <div class="step-number">2</div>
        <div class="step-icon">
          <i class="fas fa-calendar-days"></i>
        </div>
        <h4>Complete 3 Meses</h4>
        <p>A cada 3 meses de apoio vocÃª ganha 1 brinde</p>
      </div>

      <div class="step-card">
        <div class="step-number">3</div>
        <div class="step-icon">
          <i class="fas fa-gift"></i>
        </div>
        <h4>Resgate seu Brinde</h4>
        <p>Escolha e resgate seus brindes exclusivos</p>
      </div>

      <div class="step-card">
        <div class="step-number">4</div>
        <div class="step-icon">
          <i class="fas fa-truck"></i>
        </div>
        <h4>Receba em Casa</h4>
        <p>Enviamos seu brinde com todo carinho</p>
      </div>
    </div>
  </div>

  <!-- Modal de Resgate -->
  @if (showModalResgate) {
  <div class="modal-overlay" (click)="fecharModalResgate()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="fas fa-gift"></i>
          Solicitar Resgate
        </h2>
        <button class="btn-close" (click)="fecharModalResgate()" title="Fechar modal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        @if (successMessage) {
        <div class="alert alert-success">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>
        }

        @if (errorMessage) {
        <div class="alert alert-error">
          <i class="fas fa-exclamation-circle"></i>
          {{ errorMessage }}
        </div>
        }

        @if (!successMessage && brindeSelecionado) {
        <div class="brinde-preview">
          <img [src]="brindeSelecionado.foto" [alt]="brindeSelecionado.nome">
          <div class="brinde-info-modal">
            <h3>{{ brindeSelecionado.nome }}</h3>
            <p>{{ brindeSelecionado.descricao }}</p>
          </div>
        </div>

        <div class="form-section">
          <h3>
            <i class="fas fa-calendar-alt"></i>
            Escolha a Data
          </h3>
          <p class="form-hint">Selecione um dia disponÃ­vel para retirar seu brinde</p>
          <input type="date" class="input-date" [min]="getMinDate()" [max]="getMaxDate()"
            (change)="onDataChange($event)" [disabled]="isSubmitting" title="Selecione a data de resgate"
            placeholder="Selecione uma data">

          @if (dataSelecionada) {
          <div class="data-selecionada">
            <i class="fas fa-check-circle"></i>
            {{ formatarData(dataSelecionada) }}
          </div>
          }
        </div>

        @if (horariosDisponiveis.length > 0) {
        <div class="form-section">
          <h3>
            <i class="fas fa-clock"></i>
            Escolha o HorÃ¡rio
          </h3>
          <p class="form-hint">Selecione o melhor horÃ¡rio para vocÃª</p>
          <div class="horarios-grid">
            @for (horario of horariosDisponiveis; track $index) {
            <button class="horario-btn" [class.selected]="horarioSelecionado === horario"
              (click)="horarioSelecionado = horario" [disabled]="isSubmitting">
              <i class="fas fa-clock"></i>
              {{ formatarHorario(horario) }}
            </button>
            }
          </div>
        </div>
        }

        <div class="form-section">
          <h3>
            <i class="fas fa-comment"></i>
            ObservaÃ§Ãµes (opcional)
          </h3>
          <p class="form-hint">Alguma informaÃ§Ã£o adicional que queira nos passar?</p>
          <textarea class="textarea-observacoes" [(ngModel)]="observacoes"
            placeholder="Ex: Prefiro retirar na parte da manhÃ£..." rows="4" [disabled]="isSubmitting"></textarea>
        </div>

        <div class="info-resgate">
          <i class="fas fa-info-circle"></i>
          <p>
            ApÃ³s confirmar, vocÃª receberÃ¡ um email com todos os detalhes do resgate.
            Nossa equipe entrarÃ¡ em contato para confirmar o horÃ¡rio.
          </p>
        </div>
        }
      </div>

      @if (!successMessage) {
      <div class="modal-footer">
        <button class="btn-cancel" (click)="fecharModalResgate()" [disabled]="isSubmitting">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button class="btn-confirm" (click)="solicitarResgate()"
          [disabled]="!brindeSelecionado || !dataSelecionada || !horarioSelecionado || isSubmitting">
          @if (isSubmitting) {
          <span class="spinner-small"></span>
          Processando...
          } @else {
          <i class="fas fa-paper-plane"></i>
          Confirmar Resgate
          }
        </button>
      </div>
      }
    </div>
  </div>
  }
</div>