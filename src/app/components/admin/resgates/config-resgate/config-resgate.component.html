<div class="config-resgate-container">
    <div class="page-header">
        <div>
            <h1>‚è∞ Configura√ß√£o de Hor√°rios de Resgate</h1>
            <p class="subtitle">Defina os dias e hor√°rios dispon√≠veis para retirada de brindes</p>
        </div>
    </div>

    <div *ngIf="erro" class="alert alert-danger">{{ erro }}</div>
    <div *ngIf="sucesso" class="alert alert-success">{{ sucesso }}</div>

    <div *ngIf="carregando" class="loading-state">
        <div class="spinner"></div>
        <p>Carregando configura√ß√µes...</p>
    </div>

    <form *ngIf="!carregando" [formGroup]="form" (ngSubmit)="salvar()" class="config-form">

        <!-- Se√ß√£o: Dias da Semana -->
        <div class="form-section">
            <div class="section-header">
                <h2>üìÖ Dias Dispon√≠veis</h2>
                <p>Selecione os dias da semana em que ser√° poss√≠vel retirar brindes</p>
            </div>

            <div class="dias-grid">
                <div *ngFor="let dia of diasSemana" class="dia-card" [class.selecionado]="isDiaSelecionado(dia.valor)"
                    (click)="toggleDia(dia.valor)">
                    <div class="dia-icon">{{ dia.emoji }}</div>
                    <span class="dia-nome">{{ dia.nome }}</span>
                    <div class="checkbox-wrapper">
                        <label [for]="'dia-' + dia.valor" class="sr-only">Selecionar {{ dia.nome }}</label>
                        <input type="checkbox" [checked]="isDiaSelecionado(dia.valor)" (change)="toggleDia(dia.valor)"
                            (click)="$event.stopPropagation()" class="checkbox-input" [id]="'dia-' + dia.valor"
                            title="Selecionar dia da semana" [attr.aria-label]="'Selecionar ' + dia.nome">
                        <span class="checkmark">‚úì</span>
                    </div>
                </div>
            </div>

            <div class="hint-box">
                <span class="hint-icon">üí°</span>
                <p>Selecione pelo menos um dia da semana para habilitar resgates</p>
            </div>
        </div>

        <!-- Se√ß√£o: Per√≠odos de Hor√°rio -->
        <div class="form-section">
            <div class="section-header">
                <h2>üïê Per√≠odos de Atendimento</h2>
                <p>Defina os per√≠odos em que os brindes podem ser retirados</p>
            </div>

            <div class="periodos-list">
                <div *ngFor="let periodo of horarios.controls; let i = index" class="periodo-card"
                    [formGroup]="getPeriodoFormGroup(i)">
                    <div class="periodo-numero">Per√≠odo {{ i + 1 }}</div>

                    <div class="periodo-inputs">
                        <div class="input-group">
                            <label [for]="'inicio-' + i">In√≠cio</label>
                            <input type="time" formControlName="horaInicio" [id]="'inicio-' + i" class="time-input"
                                [attr.aria-label]="'Hor√°rio de in√≠cio do per√≠odo ' + (i + 1)" title="Hor√°rio de in√≠cio">
                            <div *ngIf="periodo.get('horaInicio')?.invalid && periodo.get('horaInicio')?.touched"
                                class="error-message">
                                Hor√°rio de in√≠cio obrigat√≥rio
                            </div>
                        </div>

                        <span class="separator">at√©</span>

                        <div class="input-group">
                            <label [for]="'fim-' + i">Fim</label>
                            <input type="time" formControlName="horaFim" [id]="'fim-' + i" class="time-input"
                                [attr.aria-label]="'Hor√°rio de fim do per√≠odo ' + (i + 1)" title="Hor√°rio de fim">
                            <div *ngIf="periodo.get('horaFim')?.invalid && periodo.get('horaFim')?.touched"
                                class="error-message">
                                Hor√°rio de fim obrigat√≥rio
                            </div>
                        </div>

                        <button type="button" (click)="removerPeriodo(i)" class="btn-remove"
                            [disabled]="horarios.length === 1" title="Remover per√≠odo">
                            üóëÔ∏è
                        </button>
                    </div>

                    <div *ngIf="validarPeriodo(i) && periodo.touched" class="error-message">
                        O hor√°rio de fim deve ser posterior ao hor√°rio de in√≠cio
                    </div>
                </div>
            </div>

            <button type="button" (click)="adicionarPeriodo()" class="btn btn-add">
                ‚ûï Adicionar Per√≠odo
            </button>
        </div>

        <!-- Se√ß√£o: Intervalo -->
        <div class="form-section">
            <div class="section-header">
                <h2>‚è±Ô∏è Intervalo entre Hor√°rios</h2>
                <p>Define o espa√ßamento entre os hor√°rios dispon√≠veis</p>
            </div>

            <div class="intervalo-selector">
                <div *ngFor="let opcao of opcoesIntervalo" class="intervalo-option"
                    [class.selected]="form.get('intervaloMinutos')?.value === opcao.valor"
                    (click)="form.get('intervaloMinutos')?.setValue(opcao.valor)">
                    <div class="option-icon">‚è±Ô∏è</div>
                    <div class="option-label">{{ opcao.label }}</div>
                    <div class="option-value">{{ opcao.descricao }}</div>
                </div>
            </div>

            <div class="preview-box">
                <h3>üìã Preview dos Hor√°rios</h3>
                <p class="preview-subtitle">Exemplo de hor√°rios gerados (Per√≠odo 1: {{ getPreviewPeriodo() }}):</p>
                <div class="horarios-preview">
                    <span *ngFor="let hora of getHorariosPreview()" class="horario-chip">
                        {{ hora }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Status -->
        <div class="form-section">
            <div class="section-header">
                <h2>üîß Status do Sistema</h2>
                <p>Habilitar ou desabilitar o sistema de resgates</p>
            </div>

            <div class="status-toggle">
                <label class="toggle-label">
                    <input type="checkbox" formControlName="ativo" class="toggle-input">
                    <span class="toggle-slider"></span>
                    <span class="toggle-text">
                        Sistema de Resgates {{ form.get('ativo')?.value ? 'Ativo' : 'Inativo' }}
                    </span>
                </label>
                <p class="toggle-description">
                    {{ form.get('ativo')?.value
                    ? 'Os apoiadores podem solicitar resgates de brindes'
                    : 'Sistema de resgates temporariamente desabilitado'
                    }}
                </p>
            </div>
        </div>

        <!-- A√ß√µes -->
        <div class="form-actions">
            <button type="button" (click)="resetar()" class="btn btn-secondary" [disabled]="salvando">
                üîÑ Resetar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="salvando || form.invalid">
                {{ salvando ? 'üíæ Salvando...' : 'üíæ Salvar Configura√ß√£o' }}
            </button>
        </div>
    </form>
</div>