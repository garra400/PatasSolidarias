<div class="form-animal-container">
    <header class="page-header">
        <h1>{{ isEdicao ? 'Editar Animal' : 'Novo Animal' }}</h1>
        <p class="subtitle">{{ isEdicao ? 'Atualize as informa√ß√µes do animal' : 'Adicione um novo animal ao sistema' }}
        </p>
    </header>

    <div *ngIf="erro" class="alert alert-danger">
        {{ erro }}
    </div>

    <div *ngIf="sucesso" class="alert alert-success">
        {{ sucesso }}
    </div>

    <form [formGroup]="form" (ngSubmit)="salvar()" class="animal-form">
        <div class="form-grid">
            <!-- Foto -->
            <div class="form-group form-group-full">
                <label class="form-label">Foto de Perfil</label>
                <div class="foto-upload">
                    <div class="foto-preview" *ngIf="previewUrl">
                        <img [src]="previewUrl" alt="Preview">
                    </div>
                    <div class="foto-placeholder" *ngIf="!previewUrl">
                        <span class="icon">üì∏</span>
                        <p>Nenhuma foto selecionada</p>
                    </div>
                    <div class="foto-actions">
                        <input type="file" id="foto" accept="image/*" (change)="onFileSelected($event)"
                            class="file-input">
                        <label for="foto" class="btn btn-secondary">
                            üì§ Upload Nova Foto
                        </label>
                        <button type="button" *ngIf="isEdicao && animalId" class="btn btn-outline"
                            (click)="abrirModalTrocarFoto()">
                            üñºÔ∏è Escolher da Galeria
                        </button>
                    </div>
                    <p class="hint" *ngIf="isEdicao">
                        üí° Dica: Fa√ßa upload de m√∫ltiplas fotos na se√ß√£o "Fotos" e depois escolha qual ser√° a foto de
                        perfil aqui!
                    </p>
                </div>
            </div>

            <!-- Nome -->
            <div class="form-group">
                <label for="nome" class="form-label">Nome *</label>
                <input type="text" id="nome" formControlName="nome" class="form-control" placeholder="Ex: Rex">
                <div *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched" class="error-message">
                    Nome √© obrigat√≥rio (m√≠nimo 2 caracteres)
                </div>
            </div>

            <!-- Tipo -->
            <div class="form-group">
                <label for="tipo" class="form-label">Tipo *</label>
                <select id="tipo" formControlName="tipo" class="form-control">
                    <option value="cachorro">üêï Cachorro</option>
                    <option value="gato">üêà Gato</option>
                    <option value="outro">üêæ Outro</option>
                </select>
            </div>

            <!-- Idade -->
            <div class="form-group">
                <label for="idade" class="form-label">Idade (anos) *</label>
                <input type="number" id="idade" formControlName="idade" class="form-control" min="0" placeholder="0">
                <div *ngIf="form.get('idade')?.invalid && form.get('idade')?.touched" class="error-message">
                    Idade deve ser um n√∫mero positivo
                </div>
            </div>

            <!-- Ativo -->
            <div class="form-group">
                <label class="form-label">Status</label>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="ativo" formControlName="ativo" class="checkbox-input">
                    <label for="ativo" class="checkbox-label">
                        Animal ativo no sistema
                    </label>
                </div>
            </div>

            <!-- Descri√ß√£o -->
            <div class="form-group form-group-full">
                <label for="descricao" class="form-label">Descri√ß√£o *</label>
                <textarea id="descricao" formControlName="descricao" class="form-control textarea" rows="5"
                    placeholder="Conte a hist√≥ria deste animal..."></textarea>
                <div *ngIf="form.get('descricao')?.invalid && form.get('descricao')?.touched" class="error-message">
                    Descri√ß√£o √© obrigat√≥ria (m√≠nimo 10 caracteres)
                </div>
            </div>
        </div>

        <!-- A√ß√µes -->
        <div class="form-actions">
            <button type="button" (click)="cancelar()" class="btn btn-secondary" [disabled]="carregando">
                Cancelar
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="carregando || form.invalid">
                <span *ngIf="!carregando">{{ isEdicao ? 'Atualizar' : 'Criar' }} Animal</span>
                <span *ngIf="carregando">Salvando...</span>
            </button>
        </div>
    </form>

    <!-- Modal Trocar Foto de Perfil -->
    <app-trocar-foto-perfil-modal *ngIf="mostrarModalTrocarFoto && animalId && animalAtual" [animalId]="animalId"
        [animalNome]="animalAtual.nome" [fotoPerfilAtualId]="animalAtual.fotoPerfilId"
        (fechar)="fecharModalTrocarFoto()" (fotoAlterada)="onFotoPerfilAlterada($event)">
    </app-trocar-foto-perfil-modal>
</div>