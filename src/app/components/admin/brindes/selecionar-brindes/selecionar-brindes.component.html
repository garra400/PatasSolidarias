<div class="selecionar-brindes-container">
    <div class="page-header">
        <div>
            <h1>‚≠ê Selecionar Brindes para Resgate</h1>
            <p class="subtitle">Escolha at√© {{ MAX_SELECAO }} brindes para exibir na p√°gina inicial</p>
        </div>
        <div class="header-info">
            <span class="contador" [class.contador-completo]="brindesSelecionados.length === MAX_SELECAO">
                {{ brindesSelecionados.length }} / {{ MAX_SELECAO }} selecionados
            </span>
        </div>
    </div>

    @if (erro) {
    <div class="alert alert-danger">{{ erro }}</div>
    }
    @if (sucesso) {
    <div class="alert alert-success">{{ sucesso }}</div>
    }

    @if (carregando) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Carregando brindes...</p>
    </div>
    }

    @if (!carregando && brindes.length === 0) {
    <div class="empty-state">
        <div class="empty-icon">üéÅ</div>
        <h2>Nenhum brinde ativo encontrado</h2>
        <p>Crie brindes ativos antes de selecionar quais exibir para resgate.</p>
        <a [routerLink]="['/adm/brindes/novo']" class="btn btn-primary">
            Criar Brinde
        </a>
    </div>
    }

    @if (!carregando && brindes.length > 0) {
    <div>
        <div class="info-box">
            <span class="info-icon">üí°</span>
            <div class="info-content">
                <strong>Como funciona:</strong>
                <p>
                    Selecione at√© {{ MAX_SELECAO }} brindes que os apoiadores poder√£o resgatar.
                    Ao confirmar a sele√ß√£o, <strong>todos os apoiadores receber√£o um email</strong>
                    informando sobre os brindes dispon√≠veis.
                </p>
            </div>
        </div>

        <div class="brindes-grid">
            @for (brinde of brindes; track brinde._id) {
            <div class="brinde-card" [class.selecionado]="estaSelecionado(brinde._id)"
                [class.desabilitado]="!podeSelecionar(brinde._id)"
                (click)="podeSelecionar(brinde._id) && toggleSelecao(brinde._id)">
                <label class="checkbox-overlay">
                    <input type="checkbox" [checked]="estaSelecionado(brinde._id)"
                        [disabled]="!podeSelecionar(brinde._id)" (click)="$event.stopPropagation()"
                        (change)="toggleSelecao(brinde._id)" class="checkbox-input"
                        [title]="'Selecionar brinde: ' + brinde.nome"
                        [attr.aria-label]="'Selecionar brinde ' + brinde.nome">
                    <span class="checkmark">‚úì</span>
                </label>

                <div class="card-foto">
                    <img [src]="brinde.fotoUrl || 'assets/placeholders/brinde-placeholder.svg'" [alt]="brinde.nome">
                    @if (brinde.ordem != null && brinde.ordem >= 0) {
                    <div class="ordem-badge">
                        #{{ brinde.ordem }}
                    </div>
                    }
                </div>

                <div class="card-info">
                    <h3 class="brinde-nome">{{ brinde.nome }}</h3>
                    <p class="brinde-descricao">{{ brinde.descricao }}</p>

                    @if (brinde.quantidadeDisponivel != null) {
                    <div class="estoque-info">
                        <span class="estoque-label">Estoque:</span>
                        <span class="estoque-valor">{{ brinde.quantidadeDisponivel }}</span>
                    </div>
                    }
                </div>
            </div>
            }
        </div>

        @if (brindesSelecionados.length > 0) {
        <div class="preview-section">
            <h2>üìã Preview da Sele√ß√£o</h2>
            <p class="preview-subtitle">Estes brindes aparecer√£o na p√°gina inicial:</p>

            <div class="preview-grid">
                @for (brinde of getBrindesSelecionadosDetalhes(); track brinde._id) {
                <div class="preview-item">
                    <img [src]="brinde.fotoUrl || 'assets/placeholders/brinde-placeholder.svg'" [alt]="brinde.nome">
                    <span class="preview-nome">{{ brinde.nome }}</span>
                </div>
                }
            </div>
        </div>
        }

        <div class="form-actions">
            <button type="button" (click)="cancelar()" class="btn btn-secondary" [disabled]="salvando">
                Cancelar
            </button>
            <button type="button" (click)="abrirModalConfirmacao()" class="btn btn-primary"
                [disabled]="salvando || brindesSelecionados.length === 0">
                {{ salvando ? 'Salvando...' : 'Salvar Sele√ß√£o' }}
            </button>
        </div>
    </div>
    }
</div>

<!-- Modal de Confirma√ß√£o -->
@if (mostrarModal) {
<div class="modal-overlay" (click)="fecharModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>‚ö†Ô∏è Confirmar Altera√ß√£o</h2>
            <button class="btn-close" (click)="fecharModal()" title="Fechar modal">‚úï</button>
        </div>

        <div class="modal-body">
            <div class="warning-box">
                <span class="warning-icon">üìß</span>
                <div class="warning-text">
                    <strong>Aten√ß√£o!</strong>
                    <p>
                        Ao confirmar, <strong>todos os apoiadores cadastrados receber√£o um email</strong>
                        informando sobre os brindes dispon√≠veis para resgate.
                    </p>
                </div>
            </div>

            <div class="selecao-resumo">
                <h3>Brindes selecionados ({{ brindesSelecionados.length }}):</h3>
                <!-- htmlhint-disable -->
                <ul>@for (brinde of getBrindesSelecionadosDetalhes(); track brinde._id) {<li>
                        <strong>{{ brinde.nome }}</strong>
                        <span class="resumo-descricao">{{ brinde.descricao }}</span>
                    </li>}</ul>
                <!-- htmlhint-enable -->
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" (click)="fecharModal()" class="btn btn-secondary">
                Cancelar
            </button>
            <button type="button" (click)="confirmarSelecao()" class="btn btn-primary">
                Confirmar e Enviar Email
            </button>
        </div>
    </div>
</div>
}