<div class="app-wrapper">
  <app-header></app-header>

  <!-- Botão Global da Sidebar -->
  <!-- Desktop: sempre mostra quando logado e fora do admin -->
  <!-- Mobile: mostra apenas quando NÃO estiver na área /conta -->
  @if (currentUser && !isInAdminArea && (!isMobileView || !isInAccountArea)) {
  <button class="global-sidebar-toggle" (click)="toggleAccountSidebar()" [class.active]="isSidebarOpen"
    [class.mobile-hidden]="isMobileView && isInAccountArea" title="Menu da conta">
    <span class="hamburger-icon">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </span>
  </button>

  <!-- Sidebar Global de Conta -->
  <aside class="global-account-sidebar" [class.open]="isSidebarOpen">
    <div class="sidebar-header">
      <div class="user-avatar-wrapper">
        @if (currentUser && currentUser.fotoPerfil) {
        <img [src]="getFullImageUrl(currentUser.fotoPerfil)" alt="Foto de perfil" class="user-avatar">
        } @else {
        <img src="/images/default-avatar.svg" alt="Foto de perfil" class="user-avatar">
        }
      </div>
      <h3>{{ (currentUser && currentUser.nome) || 'Minha Conta' }}</h3>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/conta" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item"
        (click)="closeSidebarIfMobile()">
        <span class="icon">🏠</span>
        <span>Dashboard</span>
      </a>

      <!-- Mostrar "Seja Apoiador" apenas se NÃO for doador -->
      @if (!isDoador()) {
      <a routerLink="/conta/seja-apoiador" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">💝</span>
        <span>Seja Apoiador</span>
      </a>
      }

      <!-- Mostrar "Doar Novamente" se já for doador -->
      @if (isDoador()) {
      <a routerLink="/conta/doar-novamente" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">💰</span>
        <span>Doar Novamente</span>
      </a>
      }

      <!-- Opções exclusivas para doadores -->
      @if (isDoador()) {
      <a routerLink="/conta/meus-brindes" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">🎁</span>
        <span>Meus Brindes</span>
      </a>

      <a routerLink="/conta/fotos" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">📸</span>
        <span>Fotos dos Animais</span>
      </a>

      <a routerLink="/conta/pagamentos" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">💳</span>
        <span>Histórico de Pagamentos</span>
      </a>
      }

      <!-- Mostrar "Minha Assinatura" apenas se tiver assinatura ativa -->
      @if (hasAssinatura()) {
      <a routerLink="/conta/assinatura" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">📋</span>
        <span>Minha Assinatura</span>
      </a>
      }

      <a routerLink="/conta/configuracoes" routerLinkActive="active" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">⚙️</span>
        <span>Configurações</span>
      </a>

      <!-- Botão Admin - apenas para admins -->
      @if (isAdmin()) {
      <a routerLink="/adm/dashboard" class="nav-item admin-link" (click)="closeSidebarIfMobile()">
        <span class="icon">🛡️</span>
        <span>Painel Administrativo</span>
      </a>
      }

      <div class="nav-divider"></div>

      <a routerLink="/" class="nav-item" (click)="closeSidebarIfMobile()">
        <span class="icon">🏠</span>
        <span>Voltar para Home</span>
      </a>

      <button (click)="logout()" class="nav-item logout-btn">
        <span class="icon">🚪</span>
        <span>Sair</span>
      </button>
    </nav>
  </aside>

  <!-- Overlay da Sidebar de Conta -->
  @if (isSidebarOpen) {
  <div class="global-sidebar-overlay" (click)="toggleAccountSidebar()"></div>
  }
  }

  <!-- Quando DESLOGADO: abre sidebar de navegação -->
  @if (!currentUser) {
  <button class="global-sidebar-toggle" (click)="toggleNavigationSidebar()" [class.active]="isNavigationSidebarOpen"
    title="Menu de navegação">
    <span class="hamburger-icon">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </span>
  </button>
  }

  <!-- Sidebar de Navegação (apenas para usuários deslogados) -->
  @if (!currentUser && isNavigationSidebarOpen) {
  <aside class="navigation-sidebar">
    <div class="sidebar-header">
      <h3>Menu de Navegação</h3>
    </div>
    <nav class="sidebar-nav">
      <a (click)="navigateToSection('home')" class="nav-item">
        <span class="icon">🏠</span>
        <span>Home</span>
      </a>
      <a (click)="navigateToSection('conheca-patinhas')" class="nav-item">
        <span class="icon">🐾</span>
        <span>Conheça nossas patinhas</span>
      </a>
      <a (click)="navigateToSection('campanha')" class="nav-item">
        <span class="icon">📢</span>
        <span>Campanha</span>
      </a>
      <div class="nav-divider"></div>
      <a routerLink="/login" (click)="closeNavigationSidebar()" class="nav-item">
        <span class="icon">🚪</span>
        <span>Entrar</span>
      </a>
    </nav>
  </aside>
  }

  <!-- Overlay da Sidebar de Navegação -->
  @if (!currentUser && isNavigationSidebarOpen) {
  <div class="navigation-sidebar-overlay" (click)="closeNavigationSidebar()"></div>
  }

  <router-outlet />

  @if (showFooter) {
  <footer class="app-footer" [class.sidebar-open]="isSidebarOpen && (isInAccountArea || isInAdminArea)"
    [class.admin-area]="isInAdminArea">
    <div class="footer-content">
      <div class="footer-info">
        <h3>🐾 Patas Solidárias</h3>
        <p>Cuidando dos animais da UTFPR-MD com amor e dedicação</p>
      </div>

      <div class="footer-social">
        <h4>Siga-nos nas redes sociais</h4>
        <div class="social-links">
          <a href="#" aria-label="LinkedIn" target="_blank" rel="noopener" class="social-link linkedin">
            <img src="/assets/images/linkedin.png" alt="LinkedIn" />
          </a>

          <a href="#" aria-label="Facebook" target="_blank" rel="noopener" class="social-link facebook">
            <img src="/assets/images/facebook.png" alt="Facebook" />
          </a>

          <a href="#" aria-label="Instagram" target="_blank" rel="noopener" class="social-link instagram">
            <img src="/assets/images/instagram.png" alt="Instagram" />
          </a>

          <a href="#" aria-label="YouTube" target="_blank" rel="noopener" class="social-link youtube">
            <img src="/assets/images/youtube.png" alt="YouTube" />
          </a>
        </div>
      </div>

      <div class="footer-copyright">
        <p>&copy; {{ currentYear }} Patas Solidárias - UTFPR Medianeira. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>
  }
</div>